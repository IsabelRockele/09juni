<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bibi's Honingjacht</title>
    <style>
        :root { --board-gap: 1.5vmin; }
        body { background-color: #fefae0; font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .pijl-links-boven { position: fixed; top: 20px; left: 20px; z-index: 1000; }
        #game-container { width: 100%; max-width: 1400px; margin: auto; }
        .hidden { display: none !important; }
        .keuze-blok { background-color: #fff; border-radius: 15px; padding: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin: 20px auto; max-width: 700px; text-align: center; }
        .bingo-afbeelding { max-width: 200px; margin: 10px auto 20px; display: block; }
        .opties { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px; }
        button.keuze { padding: 12px 25px; font-size: 1.1em; border: none; border-radius: 10px; background-color: #90e0ef; cursor: pointer; transition: background-color 0.3s; }
        button.keuze:hover, button.keuze.active { background-color: #0077b6; color: white; }
        .start-blok { margin-top: 30px; }
        #start-spel-knop { padding: 16px 32px; font-size: 1.6em; color: white; border: none; border-radius: 12px; cursor: pointer; background-color: #2e7d32; }
        #start-spel-knop:disabled { background-color: #aaa; cursor: not-allowed; }
        #game-board-container { display: flex; align-items: center; justify-content: flex-start; gap: 20px; width: 100%; }
        .game-actions { display: flex; flex-direction: column; gap: 10px; }
        #game-board { display: grid; grid-template-columns: repeat(11, 1fr); grid-template-rows: repeat(7, 1fr); gap: var(--board-gap); height: 85vh; max-height: 800px; aspect-ratio: 11 / 7; flex-grow: 1; }
        .player-area { background-color: rgba(255, 255, 255, 0.8); padding: 1.5vmin; border-radius: 15px; text-align: center; grid-row: 3 / 6; transition: box-shadow 0.3s ease-in-out; display: flex; flex-direction: column; }
        #player1-area { grid-column: 3 / 6; }
        #player2-area { grid-column: 7 / 10; }
        .player1-active { box-shadow: 0 0 15px 5px #e53935; }
        .player2-active { box-shadow: 0 0 15px 5px #0077b6; }
        .wheel-container { grid-area: 3 / 6 / 6 / 7; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; }
        #controls { grid-column: 3 / 10; grid-row: 6 / 7; display: flex; align-items: center; justify-content: center; }
        .btn-actie { padding: 10px 20px; font-size: 1.2em; border: none; border-radius: 12px; cursor: pointer; color: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.15); text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 10px; }
        .terug-pijl { height: 20px; width: auto; }
        .btn-opnieuw { background-color: #2e7d32; }
        .btn-terug { background-color: #c62828; }
        .honeycomb-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5vmin; flex-grow: 1; align-content: center; }
        .cell { width: 5.5vmin; height: 6.3vmin; background-color: #ffc107; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); display: flex; justify-content: center; align-items: center; font-size: 2.5vmin; font-weight: bold; margin: 0 auto; cursor: pointer; }
        .cell.covered { background-color: #ff9800; color: #fff; cursor: not-allowed; }
        .track-space { border-radius: 50%; display: flex; text-align:center; justify-content: center; align-items: center; position: relative; font-weight: bold; font-size: 1.2vmin; color: #333; padding: 4px; box-sizing: border-box; line-height: 1.1; }
        .flower { background-color: #f8b3c9; border: 3px dashed #e91e63; }
        .special-space { background-color: #87CEEB; border: 3px solid #4682B4; }
        .start-space, .finish-space { background: #fff; border: 3px solid #333; font-size: 1.5vmin !important; }
        .player-pawn { position: absolute; width: 4.5vmin; transition: all 0.5s ease-in-out; z-index: 10; }
        .player-pawn img { width: 100%; height: auto; filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.4)); }
        #pawn-1 { top: -0.8vmin; left: -0.8vmin; }
        #pawn-2 { bottom: 0.8vmin; right: -0.8vmin; }
        #task-question { padding: 10px; background-color: #fff9c4; border: 2px solid #fbc02d; border-radius: 10px; min-height: 40px; text-align: center; width: 100%; max-width: 400px; }
        .wheel-arrow { width: 3vmin; z-index: 11; transform: translateY(1vmin); }
        .wheel { width: 12vmin; height: 12vmin; transition: transform 4s cubic-bezier(.24,.99,.64,1); }
        .spin-btn-style { padding: 8px 16px; font-size: 1em; color: #fff; background: #4CAF50; border-radius: 8px; cursor: pointer; border: none; }
        .spin-btn-style:disabled { background: #aaa; }
    </style>
</head>
<body>

    <div class="pijl-links-boven">
        <a href="splits_spelletjes.html" class="btn-actie btn-terug">
            <img src="tafels_afbeeldingen/pijl.png" alt="Pijl" class="terug-pijl">
            Terug
        </a>
    </div>

    <div id="game-container">
        <div id="selection-screen">
            <div class="keuze-blok">
                <img src="leerjaar1_afbeeldingen/bingo.png" alt="Bingo" class="bingo-afbeelding" />
                <h2>Kies welke splitsing je wil oefenen</h2>
                <div class="opties">
                    <button class="keuze" data-level="5">Splitsen tot 5</button>
                    <button class="keuze" data-level="6">Splitsen tot 6</button>
                    <button class="keuze" data-level="7">Splitsen tot 7</button>
                    <button class="keuze" data-level="8">Splitsen tot 8</button>
                    <button class="keuze" data-level="9">Splitsen tot 9</button>
                    <button class="keuze" data-level="10">Splitsen tot 10</button>
                </div>
                <div class="start-blok">
                    <button id="start-spel-knop" disabled>Kies eerst een splitsing</button>
                </div>
            </div>
        </div>

        <div id="game-board-container" class="hidden">
            <div class="game-actions">
                <button id="btn-opnieuw" class="btn-actie btn-opnieuw">Opnieuw</button>
                <button id="btn-terug" class="btn-actie btn-terug">
                    <img src="tafels_afbeeldingen/pijl.png" alt="Pijl" class="terug-pijl">
                    Menu
                </button>
            </div>
            <div id="game-board">
                </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elementen ---
            const selectionScreen = document.getElementById('selection-screen');
            const gameBoardContainer = document.getElementById('game-board-container');
            const gameBoard = document.getElementById('game-board');
            const vasteTerugKnop = document.querySelector('.pijl-links-boven');
            const keuzeKnoppen = document.querySelectorAll('.keuze');
            const startSpelKnop = document.getElementById('start-spel-knop');
            
            // --- Spel Variabelen ---
            let targetNumber = null, currentPlayer = 1, requiredAnswer = null, gameActive = false, currentRotation = 0;
            let playerPositions = { 1: -1, 2: -1 };
            let playerGrids = { 1: [], 2: [] };
            const pathOrder = [ 66, 55, 44, 33, 22, 11, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 21, 32, 43, 54, 65, 76, 75, 74, 73, 72, 71, 70, 69, 68, 67 ];
            const specialSpaces = { 7: { type: 'forward', value: 4, text: 'Energie! 4 vooruit'}, 15: { type: 'back', value: 4, text: 'Oeps! 4 terug'}, 24: { type: 'again', text: 'Nog eens draaien!'} };

            // --- Initialisatie ---
            keuzeKnoppen.forEach(knop => {
                knop.addEventListener('click', () => {
                    keuzeKnoppen.forEach(k => k.classList.remove('active'));
                    knop.classList.add('active');
                    targetNumber = parseInt(knop.dataset.level);
                    startSpelKnop.disabled = false;
                    startSpelKnop.textContent = "Start het Spel!";
                });
            });
            startSpelKnop.addEventListener('click', () => { if (targetNumber !== null) startGame(); });
            
            // --- Spel Functies ---
            function startGame() {
                if (targetNumber === null) return; 
                selectionScreen.classList.add('hidden');
                gameBoardContainer.classList.remove('hidden');
                vasteTerugKnop.classList.add('hidden');
                buildGameBoard();
            }

            function buildGameBoard() {
                gameBoard.innerHTML = ''; 
                gameBoard.innerHTML = `
                    <div class="player-area" id="player1-area"><h2>Speler 1</h2><div class="honeycomb-grid" id="grid-player1"></div></div>
                    <div class="player-area" id="player2-area"><h2>Speler 2</h2><div class="honeycomb-grid" id="grid-player2"></div></div>
                    <div class="wheel-container">
                        <img src="leerjaar1_afbeeldingen/pijl_rad.png" alt="Pijl" class="wheel-arrow">
                        <img src="leerjaar1_afbeeldingen/rad.png" alt="Draaiwiel" class="wheel" id="wheel">
                        <button id="spin-btn" class="spin-btn-style">Draai</button>
                    </div>
                    <div id="controls"><div id="task-question"></div></div>`;

                createTrack(); 
                playerGrids[1] = generateGridNumbers(targetNumber, 9);
                playerGrids[2] = generateGridNumbers(targetNumber, 9);
                renderGrid(gameBoard.querySelector('#grid-player1'), playerGrids[1], 1);
                renderGrid(gameBoard.querySelector('#grid-player2'), playerGrids[2], 2);
                
                gameBoardContainer.querySelector('#btn-opnieuw').addEventListener('click', startGame);
                gameBoardContainer.querySelector('#btn-terug').addEventListener('click', goBackToMenu);
                gameBoard.querySelector('#spin-btn').addEventListener('click', spinWheel);
                resetGame();
            }
            
            function goBackToMenu() {
                gameBoardContainer.style.display = 'none';
                selectionScreen.classList.remove('hidden');
                vasteTerugKnop.classList.remove('hidden');
                gameActive = false;
            }

            function createTrack() {
                const numCols = 11;
                const getGridArea = (index) => `${Math.floor(index / numCols) + 1} / ${(index % numCols) + 1}`;
                pathOrder.forEach((domIndex, pathIndex) => {
                    const space = document.createElement('div');
                    space.dataset.id = domIndex;
                    space.style.gridArea = getGridArea(domIndex);
                    if (pathIndex === 0) { space.className = 'track-space start-space'; space.textContent = 'Start'; } 
                    else if (pathIndex === pathOrder.length - 1) { space.className = 'track-space finish-space'; space.textContent = 'Finish'; } 
                    else if (specialSpaces[pathIndex]) { const s = specialSpaces[pathIndex]; space.className = 'track-space special-space'; space.innerHTML = s.text; space.dataset.action = s.type; space.dataset.value = s.value || 0; } 
                    else { space.className = 'track-space flower'; const total = Math.floor(Math.random() * (targetNumber - 1)) + 2; const given = Math.floor(Math.random() * (total + 1)); const answer = total - given; space.innerHTML = `? + ${given} = ${total}`; space.dataset.answer = answer; }
                    gameBoard.appendChild(space);
                });
                const pawn1 = document.createElement('div'); pawn1.id = 'pawn-1'; pawn1.className = 'player-pawn'; pawn1.innerHTML = `<img src="leerjaar1_afbeeldingen/pion1.png" alt="Pion 1">`;
                const pawn2 = document.createElement('div'); pawn2.id = 'pawn-2'; pawn2.className = 'player-pawn'; pawn2.innerHTML = `<img src="leerjaar1_afbeeldingen/pion2.png" alt="Pion 2">`;
                gameBoard.querySelector('.start-space').appendChild(pawn1);
                gameBoard.querySelector('.start-space').appendChild(pawn2);
            }
            
            function resetGame() {
                currentPlayer = 1;
                playerPositions = { 1: -1, 2: -1 };
                gameActive = true;
                const spinBtn = gameBoard.querySelector('#spin-btn');
                spinBtn.disabled = false;
                gameBoard.querySelector('#task-question').textContent = `Speler 1 is aan de beurt. Draai aan het rad!`;
                updateActivePlayerHighlight();
                const startSpace = gameBoard.querySelector('.start-space');
                if (startSpace) {
                    const pawn1 = document.getElementById('pawn-1');
                    const pawn2 = document.getElementById('pawn-2');
                    if(pawn1) startSpace.appendChild(pawn1);
                    if(pawn2) startSpace.appendChild(pawn2);
                }
            }
            
            function spinWheel() {
                const spinBtn = gameBoard.querySelector('#spin-btn');
                const wheel = gameBoard.querySelector('#wheel');
                if (!gameActive || !spinBtn || !wheel) return;
                spinBtn.disabled = true;
                const values = [1, 2, 3, 4, 5, 6];
                const valueToAngleMap = { 1: 210, 2: 270, 3: 330, 4: 30, 5: 90, 6: 150 };
                const steps = values[Math.floor(Math.random() * values.length)];
                const targetAngle = valueToAngleMap[steps];
                currentRotation += (5 * 360) + targetAngle - (currentRotation % 360);
                wheel.style.transform = `rotate(${currentRotation}deg)`;
                setTimeout(() => {
                    gameBoard.querySelector('#task-question').textContent = `Je mag ${steps} stappen vooruit!`;
                    setTimeout(() => {
                        playerPositions[currentPlayer] += steps;
                        movePawn();
                        handleTurn();
                    }, 1000);
                }, 4100);
            }
            
            function movePawn() {
                const pawn = document.getElementById(`pawn-${currentPlayer}`);
                if (!pawn) return;
                let targetSpace;
                if (playerPositions[currentPlayer] >= pathOrder.length - 1) {
                    targetSpace = gameBoard.querySelector('.finish-space');
                } else {
                    targetSpace = gameBoard.querySelector(`[data-id="${pathOrder[playerPositions[currentPlayer]]}"]`);
                }
                if (targetSpace) { targetSpace.appendChild(pawn); }
            }
            
            function handleTurn() {
                const stepIndex = playerPositions[currentPlayer];
                const taskQuestion = gameBoard.querySelector('#task-question');
                if (stepIndex >= pathOrder.length - 1) {
                    taskQuestion.textContent = `Je hebt de finish bereikt!`;
                    requiredAnswer = null;
                    setTimeout(() => switchPlayer(true), 2000);
                    return;
                }
                const targetSpace = gameBoard.querySelector(`[data-id="${pathOrder[stepIndex]}"]`);
                if (targetSpace && targetSpace.dataset.action) {
                    handleSpecialSpace(targetSpace);
                } else if (targetSpace && targetSpace.dataset.answer) {
                    requiredAnswer = parseInt(targetSpace.dataset.answer);
                    taskQuestion.textContent = `Welk getal hoort op de plaats van het vraagteken?`;
                } else {
                    requiredAnswer = null;
                    taskQuestion.textContent = `Veilig! Geen opdracht hier.`;
                    setTimeout(() => switchPlayer(true), 2000);
                }
            }
            
            function handleSpecialSpace(space) {
                const action = space.dataset.action;
                const value = parseInt(space.dataset.value);
                const taskQuestion = gameBoard.querySelector('#task-question');
                const spinBtn = gameBoard.querySelector('#spin-btn');
                taskQuestion.textContent = space.textContent;
                switch(action) {
                    case 'again':
                        setTimeout(() => { spinBtn.disabled = false; taskQuestion.textContent = 'Draai nog eens!'; }, 1500);
                        break;
                    case 'forward':
                    case 'back':
                        setTimeout(() => {
                            playerPositions[currentPlayer] += (action === 'forward' ? value : -value);
                            if (playerPositions[currentPlayer] < 0) playerPositions[currentPlayer] = 0;
                            if (playerPositions[currentPlayer] >= pathOrder.length) playerPositions[currentPlayer] = pathOrder.length -1;
                            movePawn();
                            taskQuestion.textContent = '...en daar ga je!';
                            setTimeout(() => switchPlayer(false), 2000);
                        }, 1500);
                        break;
                }
            }
            
            function handleCellClick(player, cell) {
                const taskQuestion = gameBoard.querySelector('#task-question');
                if (player !== currentPlayer || requiredAnswer === null || cell.classList.contains('covered')) return;
                const numberClicked = parseInt(cell.dataset.number);
                if (numberClicked === requiredAnswer) {
                    cell.classList.add('covered');
                    taskQuestion.textContent = `Goed zo! Het was inderdaad ${requiredAnswer}.`;
                    checkWin(player);
                } else {
                    taskQuestion.textContent = `Oeps. Het juiste antwoord was ${requiredAnswer}.`;
                }
                if (gameActive) {
                    gameBoard.querySelector('#spin-btn').disabled = true;
                    setTimeout(() => switchPlayer(false), 2500);
                }
            }
            
            function checkWin(player) {
                const grid = gameBoard.querySelector(player === 1 ? '#grid-player1' : '#grid-player2');
                const coveredCells = grid.querySelectorAll('.covered').length;
                if (coveredCells === 9) {
                    gameBoard.querySelector('#task-question').textContent = `ðŸŽ‰ Speler ${player} heeft de honingraat vol! Hij/zij wint! ðŸŽ‰`;
                    gameActive = false;
                    gameBoard.querySelector('#spin-btn').disabled = true;
                }
            }
            
            function switchPlayer(isAfterEmptySpace = false) {
                if (!gameActive) return;
                if (!isAfterEmptySpace) { requiredAnswer = null; }
                currentPlayer = (currentPlayer === 1) ? 2 : 1;
                gameBoard.querySelector('#task-question').textContent = `Speler ${currentPlayer === 1 ? '1' : '2'} is aan de beurt. Draai aan het rad!`;
                gameBoard.querySelector('#spin-btn').disabled = false;
                updateActivePlayerHighlight();
            }
            
            function updateActivePlayerHighlight() {
                const p1 = gameBoard.querySelector('#player1-area');
                const p2 = gameBoard.querySelector('#player2-area');
                if (!p1 || !p2) return;
                if (!gameActive) { p1.classList.remove('player1-active'); p2.classList.remove('player2-active'); return; }
                if (currentPlayer === 1) { p1.classList.add('player1-active'); p2.classList.remove('player2-active'); } 
                else { p1.classList.remove('player1-active'); p2.classList.add('player2-active'); }
            }
            
            function renderGrid(gridContainer, gridData, player) {
                if (!gridContainer) return;
                gridContainer.innerHTML = '';
                playerGrids[player] = gridData;
                gridData.forEach(num => {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.textContent = num;
                    cell.dataset.number = num;
                    cell.addEventListener('click', () => handleCellClick(player, cell));
                    gridContainer.appendChild(cell);
                });
            }
            
            function generateGridNumbers(max, count) {
                let numbers = [];
                for (let i = 0; i < count; i++) { numbers.push(Math.floor(Math.random() * (max + 1))); }
                return numbers;
            }
        });
    </script>
</body>
</html>